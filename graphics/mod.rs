pub struct RGB {
    r: u8,
    g: u8,
    b: u8,
}

pub fn paint_element(pixelcolors: &mut Vec<u8>, graphic: &Vec<Vec<Option<RGB>>>, x_offset: i32, y_offset: i32, max_x: usize, max_y: usize) {
    let graphic_width = graphic[0].len();
    let graphic_height = graphic.len();

    if x_offset > max_x as i32 || y_offset > max_y as i32 {
        return //placing the graphic outside of the matrix on the right or top
    }
    if (x_offset + graphic_width as i32) < 0 || (y_offset + graphic_height as i32) < 0 {
        return
    }

    let room_for_drawing_x = max_x as i32 - x_offset;
    let room_for_drawing_y = max_y as i32 - y_offset;

    for (i, row) in graphic.iter().rev().enumerate() { //start rendering at bottom of graphic
        for col in 0.. (graphic_width) { //each x
            let mut serpentine = false;
            if (i as i32+y_offset) % 2 == 1 {
                serpentine = true;
            }

            let mut matrix_x = x_offset + col as i32;
            let matrix_y = y_offset + i as i32;

            if (col+1) > room_for_drawing_x as usize || (i+1) > room_for_drawing_y as usize {
                continue
            }
            if matrix_x < 0 || matrix_y < 0 {
                continue
            }

            if serpentine { // serpentine row
                matrix_x = max_x as i32 - 1 - x_offset - col as i32;
            }

            if let Some(rgb) = &row[col] {
                let index_in_color_vec = (matrix_x*3 + (matrix_y*max_x as i32)*3) as usize;
                pixelcolors[index_in_color_vec] = rgb.g;
                pixelcolors[index_in_color_vec+1] = rgb.r;
                pixelcolors[index_in_color_vec+2] = rgb.b;
            }
        }
    }
}


pub fn c() -> Vec<Vec<Option<u8>>> {
vec![
        vec![Some(1),Some(1), Some(1)],
        vec![Some(1), Some(1), Some(1)],
        vec![Some(1), Some(1), Some(1)],
        vec![Some(1), Some(1), Some(1)],
    ]
}

pub fn vecvec_one_up() -> Vec<Vec<Option<RGB>>> {
    let one_up = one_up();
    convert_flatvec_to_xyvec(one_up, 48, 16, Some(RGB{r:233u8, g:233u8, b:233u8}))
}

// paint_element works on a vec of vecs x*y, convert flattened representation to that
// alpha_num is the RGB value in the bytes that corresponds to a transparent pixel, optionally
fn convert_flatvec_to_xyvec( src: Vec<u8>, image_width: usize, image_height: usize, alpha: Option<RGB> ) -> Vec<Vec<Option<RGB>>> {
    let mut dest_vec = vec![vec![0;image_width]; image_height];

    for i in 0.. image_height {
        for j in 0.. image_width {
            let index_in_src_vec = j + i*image_width;
            dest_vec[i][j] = src[index_in_src_vec];
        }
    }

    let mut result = Vec::new();

    for row in dest_vec {
        let mut row_tuples = Vec::new();
        for chunk in row.chunks_exact(3) {
            if let [r, g, b] = chunk { 
                if let Some(a) = &alpha {
                    if *r==a.r && *g==a.g && *b==a.g {
                        row_tuples.push( None ); // transparent pixel
                    }
                    else {
                        row_tuples.push( Some( RGB {r:*r, g:*g, b:*b}));
                    }
                }
            }
        }
        result.push(row_tuples);
    }

    result
}

fn testflatconversion() -> Vec<Option<u8>> {
    vec![
        Some(100u8),Some(0u8),Some(0u8),Some(0u8),Some(100u8),Some(0u8),
        Some(6),Some(7),Some(4),Some(0),Some(1),Some(7),
        Some(1),Some(2),Some(3),Some(4),Some(5),Some(6)
    ]
}


/*pub fn one_up() -> Vec<u8> {
    vec![
    233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,5,9,1,2,9,1,2,10,0,0,11,0,0,12,0,1,11,0,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,
    233,233,233,233,233,233,233,233,233,7,4,15,3,9,1,99,137,4,255,255,251,4,114,0,8,117,3,8,117,0,8,117,2,4,8,1,3,9,4,233,233,233,233,233,233,233,233,233,
    233,233,233,233,233,233,212,11,11,11,106,139,14,255,253,254,255,255,255,250,253,249,2,182,0,0,185,0,0,182,0,1,183,0,249,249,246,13,122,13,0,15,0,233,233,233,233,233,233,
    233,233,233,233,233,233,240,250,225,253,252,248,255,254,255,33,199,25,2,248,1,214,254,214,216,254,216,214,255,216,209,255,209,14,247,23,6,153,20,237,254,229,2,7,1,233,233,233,
    233,233,233,0,33,0,14,175,19,0,252,4,0,253,5,2,246,8,249,255,251,254,255,255,255,255,255,255,255,255,255,255,255,255,251,255,0,246,0,0,183,2,0,119,1,2,2,2,
    233,233,233,1,23,0,247,255,246,255,255,253,6,246,0,0,248,1,254,251,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,2,247,1,0,184,0,3,121,3,233,233,233,
    233,233,233,0,2,0,254,255,255,255,255,255,255,255,255,0,252,0,254,251,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,253,3,247,2,5,183,1,254,254,233,233,233,
    233,233,233,0,1,0,254,255,255,254,255,255,254,255,255,0,184,2,0,184,0,254,255,254,255,255,255,255,255,255,255,255,255,0,184,1,1,185,0,233,233,233,233,233,233,233,233,233,
    233,233,233,0,23,0,241,255,242,254,255,254,5,116,0,0,116,2,0,117,2,1,117,2,0,116,2,0,117,2,0,117,2,0,117,2,0,118,4,233,233,233,233,233,233,233,233,233,
    233,233,233,0,28,0,0,117,2,0,117,2,1,12,0,4,9,2,3,8,1,2,6,0,3,7,0,3,8,1,2,7,0,2,9,0,0,117,2,0,118,0,98,137,0,0,0,0,
    233,233,233,233,233,233,6,11,4,1,7,0,255,254,253,254,255,255,3,8,1,255,254,255,255,254,254,3,8,0,255,255,255,255,254,255,4,9,2,3,9,1,6,8,3,233,233,233,
    233,233,233,233,233,233,0,1,0,255,255,253,254,255,255,255,255,254,10,15,9,254,255,255,255,255,254,10,15,11,255,254,255,255,255,255,251,253,250,3,7,0,233,233,233,233,233,233,
    233,233,233,233,233,233,233,233,233,2,26,0,4,88,2,252,255,251,255,255,255,255,254,254,255,255,254,255,255,255,255,255,255,1,89,2,0,20,0,233,233,233,233,233,233,233,233,233,
    233,233,233,233,233,233,233,233,233,233,233,233,0,4,0,7,12,6,10,13,6,10,13,6,10,13,6,11,13,6,10,13,6,0,4,0,205,204,204,204,204,204,233,233,233,233,233,233,
    ]
}*/
 
/*pub fn one_up() -> Vec<u8> {
    vec![
    255,255,255,254,255,255,254,255,255,255,255,255,205,205,203,5,9,1,2,9,1,2,10,0,0,11,0,0,12,0,1,11,0,255,255,255,255,255,254,255,255,254,255,255,255,201,201,201,
    255,254,255,255,255,255,204,204,204,7,4,15,3,9,1,99,137,4,255,255,251,4,114,0,8,117,3,8,117,0,8,117,2,4,8,1,3,9,4,206,204,205,254,255,254,202,203,202,
    255,254,255,212,213,212,11,11,11,106,139,14,255,253,254,255,255,255,250,253,249,2,182,0,0,185,0,0,182,0,1,183,0,249,249,246,13,122,13,0,15,0,246,255,243,254,254,255,
    255,255,255,206,206,206,240,250,225,253,252,248,255,254,255,33,199,25,2,248,1,214,254,214,216,254,216,214,255,216,209,255,209,14,247,23,6,153,20,237,254,229,2,7,1,254,255,255,
    255,255,255,0,33,0,14,175,19,0,252,4,0,253,5,2,246,8,249,255,251,254,255,255,255,255,255,255,255,255,255,255,255,255,251,255,0,246,0,0,183,2,0,119,1,2,2,2,
    255,254,255,1,23,0,247,255,246,255,255,253,6,246,0,0,248,1,254,251,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,2,247,1,0,184,0,3,121,3,255,255,255,
    254,255,255,0,2,0,254,255,255,255,255,255,255,255,255,0,252,0,254,251,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,253,3,247,2,5,183,1,254,254,252,254,255,255,
    255,255,255,0,1,0,254,255,255,254,255,255,254,255,255,0,184,2,0,184,0,254,255,254,255,255,255,255,255,255,255,255,255,0,184,1,1,185,0,255,255,255,254,255,253,255,255,255,
    255,255,255,0,23,0,241,255,242,254,255,254,5,116,0,0,116,2,0,117,2,1,117,2,0,116,2,0,117,2,0,117,2,0,117,2,0,118,4,255,255,255,254,255,255,255,255,255,
    255,254,255,0,28,0,0,117,2,0,117,2,1,12,0,4,9,2,3,8,1,2,6,0,3,7,0,3,8,1,2,7,0,2,9,0,0,117,2,0,118,0,98,137,0,0,0,0,
    255,254,255,205,205,203,6,11,4,1,7,0,255,254,253,254,255,255,3,8,1,255,254,255,255,254,254,3,8,0,255,255,255,255,254,255,4,9,2,3,9,1,6,8,3,255,255,255,
    255,255,254,254,255,255,0,1,0,255,255,253,254,255,255,255,255,254,10,15,9,254,255,255,255,255,254,10,15,11,255,254,255,255,255,255,251,253,250,3,7,0,255,255,255,254,255,255,
    255,255,254,255,255,255,205,205,205,2,26,0,4,88,2,252,255,251,255,255,255,255,254,254,255,255,254,255,255,255,255,255,255,1,89,2,0,20,0,237,242,238,202,202,202,255,255,255,
    255,255,255,254,255,254,205,205,204,204,204,204,0,4,0,7,12,6,10,13,6,10,13,6,10,13,6,11,13,6,10,13,6,0,4,0,205,204,204,204,204,204,255,254,255,255,255,255,
    ]
}

*/

pub fn one_up() -> Vec<u8> {
    vec![
        233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,0,0,0,1,0,1,1,0,1,0,0,0,0,0,0,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,
        233,233,233,233,233,233,233,233,233,233,233,233,0,0,0,0,0,0,255,255,255,83,198,24,82,198,25,255,255,255,0,0,0,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,
        233,233,233,233,233,233,233,233,233,0,0,0,254,255,254,255,254,255,255,255,254,82,199,24,83,198,24,255,255,255,255,255,255,255,255,255,0,1,0,233,233,233,233,233,233,233,233,233,
        233,233,233,233,233,233,0,0,0,82,198,24,254,255,255,255,255,255,83,199,24,82,199,24,82,198,24,82,198,24,255,255,254,255,255,255,83,198,24,0,0,0,233,233,233,233,233,233,
        233,233,233,1,0,0,255,255,255,82,199,24,82,198,25,83,198,25,82,198,25,82,198,25,82,198,25,83,199,24,82,198,24,82,198,25,83,198,25,254,255,255,0,1,1,233,233,233,
        233,233,233,0,0,0,254,255,255,255,255,255,82,198,25,82,198,24,255,255,255,255,255,255,254,255,254,255,255,255,82,198,25,83,198,24,255,255,255,255,255,254,1,0,0,233,233,233,
        0,0,1,255,255,255,255,255,255,255,255,255,82,198,24,255,255,255,255,255,255,255,255,255,255,255,254,255,254,255,255,255,254,82,198,24,255,254,255,254,254,254,254,254,255,1,0,0,
        0,0,1,255,254,255,255,255,254,255,254,255,82,199,24,255,254,255,255,254,255,254,255,255,255,255,254,255,255,255,255,255,255,82,198,25,255,254,255,255,255,255,255,254,255,0,0,0,
        1,0,1,254,255,255,255,255,255,82,198,24,82,198,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,82,198,24,82,198,24,254,254,255,254,255,255,0,0,0,
        0,0,1,82,198,24,83,199,24,83,198,24,82,198,24,82,198,24,255,254,255,255,254,254,255,255,254,255,254,255,82,198,24,82,198,24,82,198,24,82,199,24,82,198,25,1,0,0,
        1,0,1,82,198,25,82,198,24,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,82,198,24,82,199,24,0,0,0,
        233,233,233,0,0,0,0,0,0,0,0,0,254,255,255,254,255,254,1,0,0,255,254,255,255,255,255,1,0,1,254,255,255,255,255,255,0,0,0,1,0,0,0,0,0,233,233,233,
        233,233,233,233,233,233,0,0,0,255,255,255,255,255,255,254,255,255,0,0,0,255,254,255,255,255,255,1,0,0,255,254,255,255,255,254,255,255,255,0,0,0,233,233,233,233,233,233,
        233,233,233,233,233,233,0,1,0,255,255,254,255,255,255,255,255,254,255,255,254,255,255,255,255,255,254,255,254,255,254,254,254,255,254,254,255,254,255,0,0,0,233,233,233,233,233,233,
        233,233,233,233,233,233,233,233,233,1,0,0,255,254,255,255,254,255,255,255,255,254,254,255,255,255,255,254,255,255,255,255,255,255,255,254,1,1,0,233,233,233,233,233,233,233,233,233,
        233,233,233,233,233,233,233,233,233,233,233,233,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,1,0,233,233,233,233,233,233,233,233,233
    ]
}